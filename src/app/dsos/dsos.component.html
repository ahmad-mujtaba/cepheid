<div class="dso-container">
    <div class="dso-header">
        <h2 class="section-title">Deep Sky Objects</h2>
        <span class="object-count">{{dsos.length}} {{searchQuery ? 'results' : 'objects'}}</span>
    </div>

    <div class="search-box">
        <input type="text" class="search-input" placeholder="Search by name or catalogue..."
               [ngModel]="searchQuery" (ngModelChange)="onSearch($event)"
               autocomplete="off" spellcheck="false">
        @if (searchQuery) {
            <button class="search-clear" (click)="clearSearch()">&times;</button>
        }
    </div>

    <div class="filter-chips" [formGroup]="selectedTypes">
        @for (type of types; track type) {
            <label class="chip" [class.active]="selectedTypes.get(type)?.value">
                <input type="checkbox" [formControlName]="type" (change)="change()" hidden>
                {{type}}
            </label>
        }
    </div>

    <div class="dso-list">
        @for (dso of dsos; track dso.id) {
            <div class="dso-card">
                <div class="dso-top">
                    <div class="dso-identity">
                        <div class="dso-sub">
                            
                        </div>
                        <div class="dso-name">{{dso.common_name || dso.catalogue}}</div>
                        <div class="dso-sub">
                            @if (dso.common_name) {
                                <span>{{dso.catalogue}}</span>
                                <span class="dso-sep">&middot;</span>
                            }
                            <span class="dso-type">{{dso.type}}</span>
                            
                        </div>
                    </div>
                    <div class="dso-right">
                        @if (searchQuery && !dso.visibility.visibleTonight) {
                            <span class="visibility-badge not-visible">Not visible</span>
                        } @else if (searchQuery && dso.visibility.visibleTonight) {
                            <span class="visibility-badge visible">Visible</span>
                        }
                        <span class="dso-duration" [class.currently-visible]="dso.visibility.isCurrentlyVisible">{{dso.visibility.visibleDuration | prettyTime}}</span>
                    </div>
                </div>
                <div class="dso-stats">
                    <div class="stat">
                        <span class="stat-label">mag</span>
                        <span class="stat-value">{{dso.magnitude}}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">peak</span>
                        <span class="stat-value">{{dso.visibility.transitAltitude}}&deg;</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">window</span>
                        <span class="stat-value">
                            @if (dso.visibility.visibleFrom && dso.visibility.visibleUntil) {
                                {{dso.visibility.visibleFrom | date:'HH:mm'}} &ndash; {{dso.visibility.visibleUntil | date:'HH:mm'}}
                            } @else {
                                &mdash;
                            }
                        </span>
                    </div>
                     <div class="stat">
                        <span class="stat-label">RA/DEC</span>
                        <span class="stat-value">{{dso.loc}}&deg;</span>
                    </div>
                </div>
            </div>
        } @empty {
            @if (searchQuery) {
                <div class="loading-state">
                    <span>No results found</span>
                </div>
            } @else {
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <span>Loading objects...</span>
                </div>
            }
        }
    </div>
</div>
